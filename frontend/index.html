<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ChatBOT Financiero</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    </head>

    <body>
        <header class="main-header">
            <input type="checkbox" class="theme-checkbox" id="theme-toggle">
        </header>

        <div class="card-container">
        <div class="card-header">
            <div class="img-avatar"></div>
            <div class="text-chat">ChatBOT Inversor</div>
        </div>
        <div class="card-body">
            <div class="messages-container">
                <div class="message-box left">
                    <p>Â¡Hola! Soy tu asistente financiero ğŸ¤–.</p>
                    <p>Mencioname sobre quÃ© te gustarÃ­a enterarte:</p>
                        <div class="button-options">
                            <button class="option-btn">Criptomonedas ğŸ’°</button>
                            <button class="option-btn">Acciones ğŸ“ˆ</button>
                            <button class="option-btn">Cuentas remuneradas ğŸ’µ</button>
                            <button class="option-btn">DÃ³lar ğŸ’¸</button>
                            <button class="option-btn">Riesgo PaÃ­s ğŸ“Š</button>
                            <button class="option-btn">Plazo Fijo ğŸ¦</button>
                        </div>
                </div>
            </div>
            <div class="message-input">
            <form>
                <textarea placeholder="Escriba acÃ¡..." class="message-send"></textarea>
                <button type="submit" class="button-send">Enviar</button>
            </form>
            </div>
        </div>
        </div>

<script>
    function sendMessageToBot(message) {
        const container = document.querySelector(".messages-container");

        const userBox = document.createElement("div");
        userBox.className = "message-box right";
        userBox.innerHTML = `<p>${message}</p>`;
        container.appendChild(userBox);

        // Llamada al backend Flask
        fetch("/send_message", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ message: message })
        })
        .then(response => response.json())
        .then(data => {
            const botBox = document.createElement("div");
            botBox.className = "message-box left";
            botBox.innerHTML = `<p>${data.response}</p>`;
            container.appendChild(botBox);

            container.scrollTop = container.scrollHeight;
        });
    }

    document.querySelector(".button-send").addEventListener("click", function(e) {
        e.preventDefault();
        const messageInput = document.querySelector(".message-send");
        const message = messageInput.value.trim();
        if (!message) return;

        sendMessageToBot(message);
        messageInput.value = "";
    });

    // Enviar mensaje al presionar Enter
    const inputField = document.querySelector(".message-send");
    const sendButton = document.querySelector(".button-send");

    inputField.addEventListener("keydown", function(e) {
        if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            sendButton.click();
        }
    });

    // Detectar clics en los botones de opciones
    document.addEventListener("click", function(e) {
        if (e.target.classList.contains("option-btn")) {
            const message = e.target.textContent.split(" ")[0];
            sendMessageToBot(message);
        }
    });

    const themeToggle = document.getElementById('theme-toggle');

    themeToggle.addEventListener('change', () => {
        document.body.classList.toggle('dark-mode', !themeToggle.checked);
        localStorage.setItem('darkMode', themeToggle.checked ? 'disabled' : 'enabled');
    });

    // Cargar modo previo
    const darkMode = localStorage.getItem('darkMode');
    if (darkMode === 'enabled' || darkMode === null) {
        document.body.classList.add('dark-mode');
        themeToggle.checked = false;
    } else {
        document.body.classList.remove('dark-mode');
        themeToggle.checked = true;
    }
</script>

    </body>
    
</html>